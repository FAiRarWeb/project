<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Web AR Experience</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.2.0/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.7/dist/aframe/mindar-image-aframe.prod.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css">
    <style>
      body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: #000;
      }
      #startup-screen {
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: #000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        z-index: 999;
      }
      #start-button {
        display: none;
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 1.2rem;
        background-color: #28a745;
        border: none;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        transition: 0.3s;
      }
      #start-button:hover {
        background-color: #218838;
      }
      #checkmark-container {
        display: none;
        font-size: 3rem;
        color: limegreen;
      }
      #checkmark-container.show {
        display: block;
        animation: pop 0.3s ease-in-out;
      }
      @keyframes pop {
        from { transform: scale(0.5); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }
      #loading-text.ready {
        color: #28a745;
      }
      .target-text {
        font-size: 0.8em;
        color: white;
        align: center;
      }
      #websiteLink {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(255,255,255,0.9);
        padding: 8px 16px;
        border-radius: 10px;
        text-decoration: none;
        color: #000;
        font-weight: bold;
        display: none;
        z-index: 1000;
      }
      .info-button {
        position: absolute;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(255,255,255,0.8);
        padding: 10px 20px;
        border-radius: 20px;
        font-size: 1rem;
        cursor: pointer;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <!-- Startup Screen -->
    <div id="startup-screen">
      <div id="loading-spinner" class="spinner-border text-light" role="status"></div>
      <div id="checkmark-container">âœ”</div>
      <div id="loading-text" class="mt-3">Initializing AR...</div>
      <button id="start-button" onclick="startARExperience()">Start AR</button>
    </div>

    <!-- Info Button & Website Link -->
    <a id="websiteLink" href="https://example.com" target="_blank">Visit Our Website</a>
    <div class="info-button" onclick="toggleInfo()">More Info</div>

    <!-- MindAR Scene -->
    <a-scene 
      id="ar-scene"
      mindar-image="imageTargetSrc: ./targets.mind; autoStart: false;" 
      embedded 
      color-space="sRGB" 
      renderer="precision: mediump; antialias: true; logarithmicDepthBuffer: true;" 
      vr-mode-ui="enabled: false" 
      device-orientation-permission-ui="enabled: false" 
      style="display: none;"
    >
      <a-assets>
        <video id="ar-video" src="./ar-video.mp4" autoplay loop="true" crossorigin="anonymous" muted></video>
      </a-assets>

      <!-- Camera -->
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Image Target 0 -->
      <a-entity mindar-image-target="targetIndex: 0" id="target-0">
        <a-plane id="video-plane" position="0 0 0" rotation="0 0 0" width="1" height="0.6"
          material="shader: flat; src: #ar-video; transparent: true;">
        </a-plane>
        <a-text class="target-text" value="" position="0 -0.45 0" align="center" color="#FFF" width="2"></a-text>
      </a-entity>

      <!-- Image Target 1 -->
      <a-entity mindar-image-target="targetIndex: 1" id="target-1">
        <a-plane position="0 0 0" rotation="0 0 0" width="1" height="0.6"
          material="shader: flat; src: #ar-video; transparent: true;">
        </a-plane>
        <a-text class="target-text" value="" position="0 -0.45 0" align="center" color="#FFF" width="2"></a-text>
      </a-entity>
    </a-scene>

    <!-- Scripts -->
    <script>
      let isInfoShown = false;
      const websiteLink = document.getElementById("websiteLink");
      const video = document.getElementById("ar-video");
      const videoPlane = document.getElementById("video-plane");
      const targetTexts = document.querySelectorAll(".target-text");
      const startupScreen = document.getElementById("startup-screen");
      const startButton = document.getElementById("start-button");
      const arScene = document.getElementById("ar-scene");
      const loadingSpinner = document.getElementById("loading-spinner");
      const checkmarkContainer = document.getElementById("checkmark-container");
      const loadingText = document.getElementById("loading-text");

      let isARStarted = false;
      let mindarComponentsLoaded = false;

      const waitForMindARReady = () => {
        const interval = setInterval(() => {
          const mindarComponent = arScene.components["mindar-image"];
          if (mindarComponent && mindarComponent.controller) {
            clearInterval(interval);
            mindarComponentsLoaded = true;
            loadingSpinner.classList.add("d-none");
            checkmarkContainer.classList.add("show");
            loadingText.textContent = "Ready!";
            loadingText.classList.add("ready");
            startButton.style.display = "inline-block";
          }
        }, 100);
      };

      const startARExperience = () => {
        if (isARStarted || !mindarComponentsLoaded) return;
        isARStarted = true;
        startupScreen.classList.add("d-none");
        arScene.style.display = "block";
        arScene.components["mindar-image"].start();

        video.play();
        videoPlane.components.material.material.map.image = video;
        videoPlane.components.material.material.map.needsUpdate = true;
      };

      const toggleInfo = () => {
        isInfoShown = !isInfoShown;
        websiteLink.style.display = isInfoShown ? "block" : "none";
      };

      document.addEventListener("DOMContentLoaded", () => {
        waitForMindARReady();

        const target0 = document.getElementById("target-0");
        const target1 = document.getElementById("target-1");

        target0.addEventListener("targetFound", () => {
          target0.querySelector(".target-text").setAttribute("value", "Welcome to FAiR!");
        });

        target1.addEventListener("targetFound", () => {
          target1.querySelector(".target-text").setAttribute("value", "Scan complete!");
        });
      });
    </script>
  </body>
</html>
